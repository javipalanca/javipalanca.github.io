<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Demo Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
        #demo-container { width: 100%; height: 300px; border: 1px solid #ccc; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Simple Demo Test</h1>

    <div class="section">
        <h2>1. Environment Check</h2>
        <div id="env-status"></div>
    </div>

    <div class="section">
        <h2>2. Library Test</h2>
        <div id="lib-status"></div>
        <button onclick="loadVis()">Load vis.js</button>
    </div>

    <div class="section">
        <h2>3. JSON Test</h2>
        <div id="json-status"></div>
        <button onclick="testJSON()">Test demos.json</button>
    </div>

    <div class="section">
        <h2>4. Demo Test</h2>
        <div id="demo-container"></div>
        <button onclick="createSimpleDemo()">Create Simple Demo</button>
        <div id="demo-status"></div>
    </div>

    <script>
        // 1. Environment Check
        function checkEnvironment() {
            const envStatus = document.getElementById('env-status');
            let status = [];
            
            status.push(`<span class="success">✓ JavaScript enabled</span>`);
            status.push(`<span class="success">✓ DOM ready</span>`);
            status.push(`<span class="success">✓ Console available: ${typeof console !== 'undefined'}</span>`);
            
            envStatus.innerHTML = status.join('<br>');
        }

        // 2. Library Test
        function loadVis() {
            const libStatus = document.getElementById('lib-status');
            
            if (typeof vis !== 'undefined') {
                libStatus.innerHTML = '<span class="success">✓ vis.js already loaded</span>';
                return;
            }

            libStatus.innerHTML = '<span class="warning">Loading vis.js...</span>';
            
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/vis-network/standalone/umd/vis-network.min.js';
            script.onload = function() {
                libStatus.innerHTML = '<span class="success">✓ vis.js loaded successfully</span>';
                console.log('vis.js loaded:', typeof vis);
            };
            script.onerror = function() {
                libStatus.innerHTML = '<span class="error">✗ Failed to load vis.js</span>';
            };
            document.head.appendChild(script);
        }

        // 3. JSON Test
        function testJSON() {
            const jsonStatus = document.getElementById('json-status');
            jsonStatus.innerHTML = '<span class="warning">Testing demos.json...</span>';
            
            fetch('/json/demos.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.demos && Array.isArray(data.demos)) {
                        jsonStatus.innerHTML = `<span class="success">✓ demos.json loaded: ${data.demos.length} scenarios</span>`;
                        console.log('Demo data:', data);
                        window.demoData = data; // Store for later use
                    } else {
                        throw new Error('Invalid data format');
                    }
                })
                .catch(error => {
                    jsonStatus.innerHTML = `<span class="error">✗ Error: ${error.message}</span>`;
                    console.error('JSON error:', error);
                });
        }

        // 4. Demo Test
        function createSimpleDemo() {
            const demoStatus = document.getElementById('demo-status');
            const container = document.getElementById('demo-container');
            
            if (typeof vis === 'undefined') {
                demoStatus.innerHTML = '<span class="error">✗ vis.js not loaded</span>';
                return;
            }
            
            if (!window.demoData) {
                demoStatus.innerHTML = '<span class="error">✗ Demo data not loaded</span>';
                return;
            }

            try {
                // Clear container
                container.innerHTML = '';
                
                // Create network div
                const networkDiv = document.createElement('div');
                networkDiv.style.width = '100%';
                networkDiv.style.height = '100%';
                container.appendChild(networkDiv);

                // Get first demo scenario
                const firstDemo = window.demoData.demos[0];
                const agentTypes = window.demoData.agentTypes;
                
                // Create nodes
                const nodes = new vis.DataSet(firstDemo.nodes.map(node => {
                    const agentType = agentTypes[node.type];
                    return {
                        id: node.id,
                        label: agentType.label.charAt(0),
                        x: node.position?.x || Math.random() * 200,
                        y: node.position?.y || Math.random() * 200,
                        color: {
                            background: agentType.color,
                            border: agentType.color
                        }
                    };
                }));
                
                // Create edges
                const edges = new vis.DataSet(firstDemo.edges.map(edge => ({
                    from: edge.from,
                    to: edge.to,
                    arrows: 'to'
                })));

                // Create network
                const data = { nodes: nodes, edges: edges };
                const options = {
                    physics: { enabled: false }
                };
                
                const network = new vis.Network(networkDiv, data, options);
                
                demoStatus.innerHTML = '<span class="success">✓ Demo created successfully</span>';
                console.log('Demo network created:', network);
                
                // Test animation
                setTimeout(() => {
                    const nodeUpdate = { id: firstDemo.nodes[0].id, color: '#e74c3c' };
                    nodes.update(nodeUpdate);
                    demoStatus.innerHTML += '<br><span class="success">✓ Animation test successful</span>';
                }, 1000);
                
            } catch (error) {
                demoStatus.innerHTML = `<span class="error">✗ Demo creation failed: ${error.message}</span>`;
                console.error('Demo error:', error);
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkEnvironment();
            loadVis();
        });
    </script>
</body>
</html>
