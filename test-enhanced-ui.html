<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Syntax Highlighting Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .button-group {
        margin: 20px 0;
      }
      button {
        padding: 10px 20px;
        margin: 0 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .btn-primary {
        background: #007bff;
        color: white;
      }
      .btn-secondary {
        background: #6c757d;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>🔧 Enhanced Syntax Highlighting Test</h1>

      <div class="test-section">
        <h2>Test Status</h2>
        <div id="status" class="status warning">
          ⏳ Loading test environment...
        </div>
      </div>

      <div class="test-section">
        <h2>Interactive Demo Page</h2>
        <p>
          The iframe below shows the actual demo page with enhanced syntax
          highlighting:
        </p>
        <iframe
          id="demo-frame"
          src="http://localhost:4322/"
          onload="runTests()"
        ></iframe>
      </div>

      <div class="test-section">
        <h2>Test Controls</h2>
        <div class="button-group">
          <button class="btn-primary" onclick="runTests()">🔍 Run Tests</button>
          <button class="btn-secondary" onclick="location.reload()">
            🔄 Reload
          </button>
          <button class="btn-secondary" onclick="openMainPage()">
            🌐 Open Main Page
          </button>
        </div>
      </div>

      <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-results">
          <p>Tests will appear here after running...</p>
        </div>
      </div>
    </div>

    <script>
      function updateStatus(message, type = "warning") {
        const statusEl = document.getElementById("status");
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
      }

      function addTestResult(testName, result, details = "") {
        const resultsEl = document.getElementById("test-results");
        const resultEl = document.createElement("div");
        resultEl.className = `status ${result ? "success" : "error"}`;
        resultEl.innerHTML = `
                <strong>${result ? "✅" : "❌"} ${testName}</strong>
                ${details ? `<br><small>${details}</small>` : ""}
            `;
        resultsEl.appendChild(resultEl);
      }

      function runTests() {
        updateStatus(
          "🔍 Running enhanced syntax highlighting tests...",
          "warning"
        );

        const resultsEl = document.getElementById("test-results");
        resultsEl.innerHTML = "<h3>Test Results:</h3>";

        try {
          const iframe = document.getElementById("demo-frame");
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Test 1: Enhanced structure exists
          const demoCodeSection = iframeDoc.getElementById("demo-code-section");
          addTestResult(
            "Enhanced Demo Code Section Structure",
            !!demoCodeSection,
            demoCodeSection
              ? `Found with classes: ${demoCodeSection.className}`
              : "Section not found"
          );

          // Test 2: Enhanced styling elements
          if (demoCodeSection) {
            const codeHeader = demoCodeSection.querySelector(".code-header");
            const codeBody = demoCodeSection.querySelector(".code-body");
            const copyBtn = demoCodeSection.querySelector(".copy-btn");

            addTestResult(
              "Enhanced CSS Structure",
              codeHeader && codeBody && copyBtn,
              `Header: ${!!codeHeader}, Body: ${!!codeBody}, Copy Button: ${!!copyBtn}`
            );
          }

          // Test 3: Prism.js functionality
          const prismAvailable =
            typeof iframe.contentWindow.Prism !== "undefined";
          addTestResult(
            "Prism.js Available",
            prismAvailable,
            prismAvailable
              ? "Prism.js is loaded and ready"
              : "Prism.js not found"
          );

          // Test 4: Compare with working section
          const workingCodeBlocks = iframeDoc.querySelectorAll(
            '#code-section .code-body pre code[class*="language-"]'
          );
          const demoCodeBlock = iframeDoc.querySelector(
            '#demo-code-section .code-body pre code[class*="language-"]'
          );

          if (workingCodeBlocks.length > 0 && demoCodeBlock) {
            const workingHasTokens =
              workingCodeBlocks[0].querySelector(".token") !== null;
            const demoHasTokens =
              demoCodeBlock.querySelector(".token") !== null;

            addTestResult(
              "Syntax Highlighting Comparison",
              workingHasTokens === demoHasTokens && demoHasTokens,
              `Working section tokens: ${workingHasTokens}, Demo section tokens: ${demoHasTokens}`
            );
          } else {
            addTestResult(
              "Syntax Highlighting Comparison",
              false,
              "Could not find code blocks to compare"
            );
          }

          // Test 5: Toggle functionality
          const toggleBtn = iframeDoc.getElementById("toggle-code");
          addTestResult(
            "Toggle Button Available",
            !!toggleBtn,
            toggleBtn
              ? "Toggle button found and ready"
              : "Toggle button not found"
          );

          updateStatus("✅ Tests completed! Check results below.", "success");
        } catch (error) {
          updateStatus(`❌ Test failed: ${error.message}`, "error");
          addTestResult("Test Execution", false, error.message);
        }
      }

      function openMainPage() {
        window.open("http://localhost:4322/", "_blank");
      }

      // Auto-run tests when page loads
      window.addEventListener("load", function () {
        setTimeout(() => {
          updateStatus("✅ Test environment ready", "success");
        }, 2000);
      });
    </script>
  </body>
</html>
