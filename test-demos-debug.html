<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug SPADE Demos</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .demo-container {
        border: 1px solid #ccc;
        padding: 20px;
        margin: 20px 0;
      }
      #agent-network {
        width: 100%;
        height: 400px;
        border: 1px solid #ddd;
      }
      .controls {
        margin: 10px 0;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>SPADE Demos Debug</h1>

    <div class="demo-container">
      <h2>Step 1: Check Libraries</h2>
      <div id="library-check"></div>
    </div>

    <div class="demo-container">
      <h2>Step 2: Check Demo Data</h2>
      <div id="data-check"></div>
    </div>

    <div class="demo-container">
      <h2>Step 3: Test Basic Network</h2>
      <div id="agent-network"></div>
      <div class="controls">
        <button id="test-network">Test Network Creation</button>
        <button id="test-demo">Test Demo Loading</button>
      </div>
      <div id="network-status"></div>
    </div>

    <script>
      // Step 1: Check if libraries are loaded
      document.addEventListener("DOMContentLoaded", function () {
        const libraryCheck = document.getElementById("library-check");
        let checks = [];

        if (typeof vis !== "undefined") {
          checks.push(
            '<span class="success">✓ vis.js loaded successfully</span>'
          );
        } else {
          checks.push('<span class="error">✗ vis.js not loaded</span>');
        }

        libraryCheck.innerHTML = checks.join("<br>");

        // Step 2: Check demo data
        const dataCheck = document.getElementById("data-check");
        fetch("/json/demos.json")
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            dataCheck.innerHTML = `<span class="success">✓ Demo data loaded: ${data.demos.length} scenarios</span>`;
            console.log("Demo data:", data);
          })
          .catch((error) => {
            dataCheck.innerHTML = `<span class="error">✗ Error loading demo data: ${error.message}</span>`;
          });

        // Step 3: Test network creation
        document
          .getElementById("test-network")
          .addEventListener("click", function () {
            testNetworkCreation();
          });

        document
          .getElementById("test-demo")
          .addEventListener("click", function () {
            testDemoScript();
          });
      });

      function testNetworkCreation() {
        const statusDiv = document.getElementById("network-status");
        const container = document.getElementById("agent-network");

        try {
          // Simple test data
          const nodes = new vis.DataSet([
            { id: 1, label: "Agent 1", x: 100, y: 100, color: "#3498db" },
            { id: 2, label: "Agent 2", x: 300, y: 100, color: "#2ecc71" },
          ]);

          const edges = new vis.DataSet([{ from: 1, to: 2, arrows: "to" }]);

          const data = { nodes: nodes, edges: edges };
          const options = {
            physics: { enabled: false },
          };

          const network = new vis.Network(container, data, options);
          statusDiv.innerHTML =
            '<span class="success">✓ Network created successfully</span>';

          // Test animation
          setTimeout(() => {
            nodes.update({ id: 1, color: "#e74c3c" });
            statusDiv.innerHTML +=
              '<br><span class="success">✓ Animation test successful</span>';
          }, 1000);
        } catch (error) {
          statusDiv.innerHTML = `<span class="error">✗ Network creation failed: ${error.message}</span>`;
          console.error("Network error:", error);
        }
      }

      function testDemoScript() {
        const statusDiv = document.getElementById("network-status");

        // Load the actual demo script
        const script = document.createElement("script");
        script.src = "/js/demos.js";
        script.onload = function () {
          statusDiv.innerHTML +=
            '<br><span class="success">✓ Demo script loaded</span>';

          // Test AgentDemo initialization
          if (typeof AgentDemo !== "undefined") {
            statusDiv.innerHTML +=
              '<br><span class="success">✓ AgentDemo object available</span>';

            // Try to initialize
            try {
              AgentDemo.init();
              statusDiv.innerHTML +=
                '<br><span class="success">✓ AgentDemo initialized</span>';
            } catch (error) {
              statusDiv.innerHTML += `<br><span class="error">✗ AgentDemo initialization failed: ${error.message}</span>`;
            }
          } else {
            statusDiv.innerHTML +=
              '<br><span class="error">✗ AgentDemo object not found</span>';
          }
        };
        script.onerror = function () {
          statusDiv.innerHTML +=
            '<br><span class="error">✗ Demo script failed to load</span>';
        };
        document.head.appendChild(script);
      }
    </script>
  </body>
</html>
